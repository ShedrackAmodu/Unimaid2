{% extends 'base.html' %}

{% block title %}{{ author.name }} - Library Author{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="/catalog/">Catalog</a></li>
<li class="breadcrumb-item"><a href="/catalog/authors/">Authors</a></li>
<li class="breadcrumb-item active" aria-current="page">{{ author.name|truncatechars:30 }}</li>
{% endblock %}

{% block page_header %}
<div class="row mb-5 animate__animated animate__fadeIn">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-start flex-wrap">
            <div class="d-flex align-items-start">
                <!-- Author Avatar -->
                <div class="author-header-avatar me-4 d-none d-md-block">
                    <div class="avatar-container rounded-circle d-flex align-items-center justify-content-center"
                         style="width: 120px; height: 120px; background: linear-gradient(135deg, #0a2472, #3a86ff);">
                        <span class="text-white fs-1 fw-bold">{{ author.name|first|upper }}</span>
                    </div>
                </div>
                
                <!-- Author Info -->
                <div>
                    <h1 class="display-4 fw-bold mb-2">{{ author.name }}</h1>
                    <div class="d-flex flex-wrap align-items-center gap-2 mb-3">
                        <span class="badge bg-primary">
                            <i class="bi bi-book me-1"></i>{{ author.books.count }} books
                        </span>
                        <span class="badge bg-success">
                            <i class="bi bi-star me-1"></i>Featured Author
                        </span>
                        {% if author.bio %}
                        <span class="badge bg-info">
                            <i class="bi bi-pen me-1"></i>Biography Available
                        </span>
                        {% endif %}
                    </div>
                    <p class="lead text-muted mb-0">
                        {% if author.bio %}
                        {{ author.bio|truncatechars:150 }}
                        {% else %}
                        Prolific author with {{ author.books.count }} published works in our library collection.
                        {% endif %}
                    </p>
                </div>
            </div>
            <div class="mt-3 mt-md-0">
                {% if user.is_staff %}
                <div class="dropdown">
                    <button class="btn btn-outline-primary dropdown-toggle" type="button" 
                            data-bs-toggle="dropdown">
                        <i class="bi bi-gear me-1"></i>Manage
                    </button>
                    <ul class="dropdown-menu">
                        <li>
                            <a class="dropdown-item" href="/admin/catalog/author/{{ author.id }}/change/">
                                <i class="bi bi-pencil me-2"></i>Edit Author
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="/admin/catalog/book/add/?author={{ author.id }}">
                                <i class="bi bi-plus-circle me-2"></i>Add Book
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item text-danger" href="/admin/catalog/author/{{ author.id }}/delete/">
                                <i class="bi bi-trash me-2"></i>Delete Author
                            </a>
                        </li>
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<!-- Author Details Section -->
<div class="row mb-5">
    <!-- Author Sidebar -->
    <div class="col-lg-4 mb-5 mb-lg-0">
        <div class="card border-0 shadow-lg sticky-top" style="top: 100px;">
            <div class="card-body p-4">
                <!-- Author Portrait -->
                <div class="author-portrait mb-4">
                    <div class="portrait-container rounded-4 overflow-hidden position-relative">
                        <div class="portrait-placeholder d-flex align-items-center justify-content-center"
                             style="height: 300px; background: linear-gradient(135deg, #0a2472, #3a86ff);">
                            <div class="text-center text-white">
                                <span class="display-1 fw-bold d-block">{{ author.name|first|upper }}</span>
                                <span class="fs-5">{{ author.name }}</span>
                            </div>
                        </div>
                        <div class="position-absolute top-0 end-0 m-3">
                            <span class="badge bg-primary px-3 py-2 fs-6">
                                <i class="bi bi-award me-1"></i>Author
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- Author Stats -->
                <div class="author-stats-card mb-4">
                    <div class="card border-0 bg-light">
                        <div class="card-body p-4">
                            <h5 class="fw-bold mb-4">Author Statistics</h5>
                            <div class="stats-grid">
                                <div class="stat-item text-center mb-4">
                                    <div class="stat-number fw-bold text-primary fs-3 mb-2">
                                        {{ author.books.count }}
                                    </div>
                                    <div class="stat-label text-muted">Total Books</div>
                                </div>
                                <div class="stat-item text-center mb-4">
                                    <div class="stat-number fw-bold text-success fs-3 mb-2">
                                        {{ available_books|default:author.books.count }}
                                    </div>
                                    <div class="stat-label text-muted">Available Now</div>
                                </div>
                                <div class="stat-item text-center mb-4">
                                    <div class="stat-number fw-bold text-warning fs-3 mb-2">
                                        {{ avg_pages|default:"300" }}
                                    </div>
                                    <div class="stat-label text-muted">Avg Pages</div>
                                </div>
                                <div class="stat-item text-center mb-4">
                                    <div class="stat-number fw-bold text-info fs-3 mb-2">
                                        {{ years_active|default:"15" }}
                                    </div>
                                    <div class="stat-label text-muted">Years Active</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="quick-actions mb-4">
                    <div class="d-grid gap-2">
                        {% if user.is_authenticated %}
                        <button class="btn btn-outline-primary" id="followAuthor">
                            <i class="bi bi-bell me-2"></i>
                            <span>Follow Author</span>
                        </button>
                        {% endif %}
                        <button class="btn btn-outline-primary" onclick="printAuthorDetails()">
                            <i class="bi bi-printer me-2"></i>
                            <span>Print Profile</span>
                        </button>
                        <button class="btn btn-outline-primary" onclick="shareAuthor()">
                            <i class="bi bi-share me-2"></i>
                            <span>Share Profile</span>
                        </button>
                        <a href="/catalog/books/?author={{ author.id }}" class="btn btn-primary">
                            <i class="bi bi-book me-2"></i>
                            <span>View All Books</span>
                        </a>
                    </div>
                </div>
                
                <!-- Author Information -->
                <div class="author-info-card">
                    <div class="card border-0 bg-light">
                        <div class="card-body p-4">
                            <h6 class="fw-bold mb-3">Additional Information</h6>
                            <div class="info-list">
                                <div class="info-item mb-3">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-calendar text-primary me-3"></i>
                                        <div>
                                            <small class="text-muted d-block">First Publication</small>
                                            <span class="fw-bold">{{ first_publication|default:"2005" }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="info-item mb-3">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-tags text-primary me-3"></i>
                                        <div>
                                            <small class="text-muted d-block">Primary Genre</small>
                                            <span class="fw-bold">{{ primary_genre|default:"Fiction" }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="info-item mb-3">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-translate text-primary me-3"></i>
                                        <div>
                                            <small class="text-muted d-block">Languages</small>
                                            <span class="fw-bold">{{ languages|default:"English" }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-award text-primary me-3"></i>
                                        <div>
                                            <small class="text-muted d-block">Awards</small>
                                            <span class="fw-bold">{{ awards_count|default:"5+" }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Author Content -->
    <div class="col-lg-8">
        <!-- Biography Section -->
        <div class="card border-0 shadow-lg mb-4">
            <div class="card-header bg-transparent border-0 py-3">
                <h3 class="fw-bold mb-0">Biography</h3>
            </div>
            <div class="card-body p-4">
                <div class="author-biography">
                    {% if author.bio %}
                    <div class="bio-content">
                        {{ author.bio|linebreaks }}
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-person-lines-fill text-muted fs-1 mb-3"></i>
                        <h5 class="text-muted mb-3">Biography Not Available</h5>
                        <p class="text-muted">
                            We're currently gathering more information about this author. 
                            Check back soon for updates.
                        </p>
                    </div>
                    {% endif %}
                </div>
                
                {% if author.bio and author.bio|length > 500 %}
                <button class="btn btn-link text-primary mt-3" id="readMoreBioBtn">
                    Read More <i class="bi bi-chevron-down"></i>
                </button>
                {% endif %}
            </div>
        </div>
        
        <!-- Books by This Author -->
        <div class="card border-0 shadow-lg mb-4">
            <div class="card-header bg-transparent border-0 py-3 d-flex justify-content-between align-items-center">
                <div>
                    <h3 class="fw-bold mb-0">Books by {{ author.name }}</h3>
                    <p class="text-muted mb-0 small">{{ author.books.count }} books in our collection</p>
                </div>
                <span class="badge bg-primary">{{ available_books|default:author.books.count }} Available</span>
            </div>
            <div class="card-body p-4">
                {% if books %}
                <div class="row g-4">
                    {% for book in books|slice:":6" %}
                    <div class="col-lg-4 col-md-6">
                        <div class="card book-card h-100 border-0 shadow-hover">
                            <div class="position-relative">
                                  <img src="images/librarybooks.jfif" class="card-img-top h-200 img-cover--fixed" alt="{{ book.title }}">
                                <div class="position-absolute top-0 start-0 m-2">
                                    {% if book.is_available %}
                                    <span class="badge bg-success">Available</span>
                                    {% else %}
                                    <span class="badge bg-warning">Checked Out</span>
                                    {% endif %}
                                </div>
                                {% if book.publication_date.year >= 2023 %}
                                <div class="position-absolute top-0 end-0 m-2">
                                    <span class="badge bg-danger">New</span>
                                </div>
                                {% endif %}
                            </div>
                            <div class="card-body p-3">
                                <h6 class="fw-bold mb-2">{{ book.title|truncatechars:40 }}</h6>
                                <p class="text-muted small mb-3">
                                    <i class="bi bi-building me-1"></i>{{ book.publisher.name|truncatechars:20 }}
                                </p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="badge bg-light text-dark">{{ book.genre.name }}</span>
                                    <div class="btn-group">
                                        <a href="/catalog/books/{{ book.id }}/" class="btn btn-sm btn-outline-primary">
                                            View
                                        </a>
                                        {% if user.is_authenticated and book.is_available %}
                                        <a href="/circulation/reserve/{{ book.id }}/" 
                                           class="btn btn-sm btn-primary">
                                            Reserve
                                        </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                {% if books.count > 6 %}
                <div class="text-center mt-4">
                    <a href="/catalog/books/?author={{ author.id }}" class="btn btn-primary btn-lg">
                        <i class="bi bi-arrow-right-circle me-2"></i>
                        View All {{ author.books.count }} Books
                    </a>
                </div>
                {% endif %}
                
                {% else %}
                <div class="text-center py-5">
                    <i class="bi bi-book text-muted fs-1 mb-3"></i>
                    <h5 class="text-muted mb-3">No Books Found</h5>
                    <p class="text-muted mb-4">
                        This author currently has no books in our collection.
                    </p>
                    {% if user.is_staff %}
                    <a href="/admin/catalog/book/add/?author={{ author.id }}" 
                       class="btn btn-primary">
                        <i class="bi bi-plus-circle me-2"></i>Add First Book
                    </a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Book Statistics -->
        <div class="row g-4 mb-4">
            <div class="col-md-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body p-4">
                        <h5 class="fw-bold mb-4">Publication Timeline</h5>
                        <div class="timeline">
                            <div class="timeline-item mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span class="fw-bold">Early Works</span>
                                    <span class="text-muted">2005-2010</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar bg-primary" style="width: 30%"></div>
                                </div>
                                <small class="text-muted">3 books published</small>
                            </div>
                            <div class="timeline-item mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span class="fw-bold">Mid Career</span>
                                    <span class="text-muted">2011-2018</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar bg-success" style="width: 50%"></div>
                                </div>
                                <small class="text-muted">5 books published</small>
                            </div>
                            <div class="timeline-item">
                                <div class="d-flex justify-content-between mb-1">
                                    <span class="fw-bold">Recent Works</span>
                                    <span class="text-muted">2019-2024</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar bg-warning" style="width: 70%"></div>
                                </div>
                                <small class="text-muted">7 books published</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body p-4">
                        <h5 class="fw-bold mb-4">Genres by This Author</h5>
                        <div class="genres-chart">
                            {% for genre in genres|slice:":5" %}
                            <div class="genre-item mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span class="fw-bold">{{ genre.name }}</span>
                                    <span class="text-muted">{{ genre.book_count }} books</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar" 
                                         style="width: {% widthratio genre.book_count max_genre_count 100 %}%;
                                                background-color: {% cycle '#0a2472' '#001f3f' '#3a86ff' '#4361ee' '#7209b7' %}">
                                    </div>
                                </div>
                            </div>
                            {% empty %}
                            <div class="text-center py-4">
                                <i class="bi bi-tags text-muted fs-1 mb-3"></i>
                                <p class="text-muted">No genre data available</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Popular Books -->
        <div class="card border-0 shadow-lg mb-4">
            <div class="card-header bg-transparent border-0 py-3">
                <h3 class="fw-bold mb-0">Most Popular Books</h3>
                <p class="text-muted mb-0 small">Based on library loans and reservations</p>
            </div>
            <div class="card-body p-4">
                {% if popular_books %}
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">Book Title</th>
                                <th scope="col">Genre</th>
                                <th scope="col">Year</th>
                                <th scope="col">Loans</th>
                                <th scope="col" class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for book in popular_books|slice:":5" %}
                            <tr>
                                <td>
                                    <h6 class="fw-bold mb-1">{{ book.title|truncatechars:40 }}</h6>
                                    <small class="text-muted">{{ book.publisher.name|truncatechars:20 }}</small>
                                </td>
                                <td>
                                    <span class="badge bg-light text-dark">{{ book.genre.name }}</span>
                                </td>
                                <td>
                                    <small class="text-muted">{{ book.publication_date.year }}</small>
                                </td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-book text-primary me-2"></i>
                                        <span class="fw-bold">{{ book.loan_count|default:"150" }}</span>
                                    </div>
                                </td>
                                <td class="text-end">
                                    <div class="btn-group" role="group">
                                        <a href="/catalog/books/{{ book.id }}/" class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-eye"></i>
                                        </a>
                                        {% if user.is_authenticated and book.is_available %}
                                        <a href="/circulation/reserve/{{ book.id }}/" class="btn btn-sm btn-primary">
                                            <i class="bi bi-bookmark"></i>
                                        </a>
                                        {% endif %}
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="bi bi-graph-up text-muted fs-1 mb-3"></i>
                    <p class="text-muted">Popularity data not available yet</p>
                </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Similar Authors -->
        <div class="card border-0 shadow-lg">
            <div class="card-header bg-transparent border-0 py-3">
                <h3 class="fw-bold mb-0">Similar Authors</h3>
                <p class="text-muted mb-0 small">Authors writing in similar genres or styles</p>
            </div>
            <div class="card-body p-4">
                <div class="row g-4">
                    {% for similar_author in similar_authors|slice:":4" %}
                    <div class="col-lg-3 col-md-6">
                        <div class="similar-author-card">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-body p-3 text-center">
                                    <div class="similar-author-avatar mb-3 mx-auto">
                                        <div class="rounded-circle d-flex align-items-center justify-content-center"
                                             style="width: 80px; height: 80px; background: linear-gradient(135deg, 
                                                    {% cycle '#0a2472' '#001f3f' '#3a86ff' '#4361ee' as bgcolor %}, 
                                                    {% cycle '#3a86ff' '#4361ee' '#0a2472' '#001f3f' as bgcolor2 %});">
                                            <span class="text-white fw-bold">{{ similar_author.name|first|upper }}</span>
                                        </div>
                                    </div>
                                    <h6 class="fw-bold mb-2">{{ similar_author.name|truncatechars:20 }}</h6>
                                    <p class="text-muted small mb-3">
                                        {{ similar_author.books.count }} books
                                    </p>
                                    <a href="/catalog/authors/{{ similar_author.id }}/" 
                                       class="btn btn-sm btn-outline-primary">
                                        View Profile
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="col-12">
                        <div class="text-center py-4">
                            <i class="bi bi-people text-muted fs-1 mb-3"></i>
                            <p class="text-muted">No similar authors found</p>
                            <a href="/catalog/authors/" class="btn btn-outline-primary">
                                <i class="bi bi-arrow-right me-2"></i>Browse All Authors
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modals -->
<!-- Follow Author Modal -->
<div class="modal fade" id="followModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold">Follow {{ author.name }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Get notifications when new books by <strong>{{ author.name }}</strong> are added to our collection.</p>
                <div class="mb-3">
                    <label class="form-label">Notification Preferences</label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="newBooksNotify" checked>
                        <label class="form-check-label" for="newBooksNotify">
                            New book releases
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="eventsNotify">
                        <label class="form-check-label" for="eventsNotify">
                            Author events and talks
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="recommendationsNotify">
                        <label class="form-check-label" for="recommendationsNotify">
                            Reading recommendations
                        </label>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Frequency</label>
                    <select class="form-select">
                        <option value="immediate">Immediate notifications</option>
                        <option value="daily" selected>Daily digest</option>
                        <option value="weekly">Weekly summary</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="followAuthor()">
                    Start Following
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Books by Year Modal -->
<div class="modal fade" id="booksByYearModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold">Books by Publication Year</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Year</th>
                                <th>Book Title</th>
                                <th>Genre</th>
                                <th>Publisher</th>
                                <th class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for book in books|dictsort:"publication_date.year" %}
                            <tr>
                                <td><strong>{{ book.publication_date.year }}</strong></td>
                                <td>{{ book.title|truncatechars:40 }}</td>
                                <td><span class="badge bg-light text-dark">{{ book.genre.name }}</span></td>
                                <td>{{ book.publisher.name|truncatechars:20 }}</td>
                                <td class="text-end">
                                    <a href="/catalog/books/{{ book.id }}/" class="btn btn-sm btn-outline-primary">
                                        View
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ block.super }}
<style>
    /* Author Detail Specific Styles */
    .author-header-avatar .avatar-container {
        box-shadow: 0 10px 30px rgba(0, 31, 63, 0.2);
        transition: transform 0.3s ease;
    }
    
    .author-header-avatar:hover .avatar-container {
        transform: scale(1.05);
    }
    
    .portrait-container {
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        transition: transform 0.3s ease;
    }
    
    .portrait-container:hover {
        transform: scale(1.02);
    }
    
    .portrait-placeholder {
        background-size: cover;
        background-position: center;
    }
    
    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }
    
    .stat-item {
        padding: 1rem;
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        transition: all 0.2s ease;
    }
    
    .stat-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
    }
    
    /* Quick Actions */
    .quick-actions .btn {
        transition: all 0.2s ease;
    }
    
    .quick-actions .btn:hover {
        transform: translateY(-2px);
    }
    
    /* Info List */
    .info-item {
        padding: 0.5rem 0;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .info-item:last-child {
        border-bottom: none;
    }
    
    /* Biography */
    .bio-content {
        line-height: 1.8;
        color: var(--dark-text);
        max-height: 300px;
        overflow: hidden;
        position: relative;
    }
    
    .bio-content.expanded {
        max-height: none;
    }
    
    .bio-content::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 50px;
        background: linear-gradient(transparent, var(--light-text));
        opacity: 1;
        transition: opacity 0.3s ease;
    }
    
    .bio-content.expanded::after {
        opacity: 0;
    }
    
    /* Book Cards */
    .book-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .book-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15) !important;
    }
    
    .book-card .card-img-top {
        transition: transform 0.5s ease;
    }
    
    .book-card:hover .card-img-top {
        transform: scale(1.05);
    }
    
    /* Timeline */
    .timeline-item .progress-bar {
        border-radius: 4px;
    }
    
    /* Genres Chart */
    .genres-chart .progress-bar {
        border-radius: 4px;
        transition: width 0.5s ease;
    }
    
    .genre-item:hover .progress-bar {
        opacity: 0.9;
    }
    
    /* Table Styles */
    .table th {
        background-color: rgba(0, 31, 63, 0.05);
        border-bottom: 2px solid var(--primary-blue);
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 0.5px;
    }
    
    .table td {
        vertical-align: middle;
        padding: 1rem;
    }
    
    .table tbody tr {
        transition: all 0.2s ease;
    }
    
    .table tbody tr:hover {
        background-color: rgba(0, 123, 255, 0.05);
    }
    
    /* Similar Authors */
    .similar-author-card .card {
        transition: all 0.3s ease;
    }
    
    .similar-author-card .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1) !important;
    }
    
    .similar-author-avatar {
        transition: all 0.3s ease;
    }
    
    .similar-author-card:hover .similar-author-avatar {
        transform: scale(1.1);
    }
    
    /* Modal Styles */
    .modal-content {
        border-radius: 16px;
        border: none;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    
    .modal-header {
        border-bottom: 2px solid var(--primary-blue);
        background: var(--gradient-1);
        color: white;
        border-radius: 16px 16px 0 0;
    }
    
    .modal-title {
        color: white;
    }
    
    /* Responsive Adjustments */
    @media (max-width: 768px) {
        .author-header-avatar {
            margin-right: 1rem;
            margin-bottom: 1rem;
        }
        
        .author-header-avatar .avatar-container {
            width: 80px;
            height: 80px;
        }
        
        .author-header-avatar .avatar-container span {
            font-size: 1.5rem;
        }
        
        .portrait-container {
            height: 200px;
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .book-card {
            margin-bottom: 1rem;
        }
        
        .table-responsive {
            font-size: 0.9rem;
        }
    }
    
    /* Print Styles */
    @media print {
        .navbar, .footer, .quick-actions, .modal, .similar-author-card {
            display: none !important;
        }
        
        .card {
            box-shadow: none !important;
            border: 1px solid #dee2e6;
        }
        
        .portrait-container {
            max-width: 200px;
            margin: 0 auto 2rem;
        }
        
        .bio-content {
            max-height: none !important;
        }
        
        a {
            color: black !important;
            text-decoration: none !important;
        }
    }
    
    /* Animation Classes */
    .fade-in {
        animation: fadeIn 0.5s ease;
    }
    
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Read More/Less functionality for biography
        const biography = document.querySelector('.bio-content');
        const readMoreBtn = document.getElementById('readMoreBioBtn');
        
        if (readMoreBtn && biography) {
            readMoreBtn.addEventListener('click', function() {
                biography.classList.toggle('expanded');
                
                if (biography.classList.contains('expanded')) {
                    this.innerHTML = 'Read Less <i class="bi bi-chevron-up"></i>';
                } else {
                    this.innerHTML = 'Read More <i class="bi bi-chevron-down"></i>';
                }
                
                // Smooth scroll to maintain reading position
                this.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            });
        }
        
        // Follow Author functionality
        const followBtn = document.getElementById('followAuthor');
        if (followBtn) {
            followBtn.addEventListener('click', function() {
                const modal = new bootstrap.Modal(document.getElementById('followModal'));
                modal.show();
            });
        }
        
        // Follow author function
        window.followAuthor = function() {
            const newBooksNotify = document.getElementById('newBooksNotify').checked;
            const eventsNotify = document.getElementById('eventsNotify').checked;
            const recommendationsNotify = document.getElementById('recommendationsNotify').checked;
            
            // Show loading state
            const modal = bootstrap.Modal.getInstance(document.getElementById('followModal'));
            const followBtn = modal._element.querySelector('.btn-primary');
            const originalText = followBtn.innerHTML;
            
            followBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Following...';
            followBtn.disabled = true;
            
            // Simulate API call
            setTimeout(() => {
                // Success
                showToast(`Now following ${author.name}! You'll get notifications about new books.`, 'success');
                
                // Update modal
                modal.hide();
                
                // Update follow button
                const mainFollowBtn = document.getElementById('followAuthor');
                if (mainFollowBtn) {
                    const icon = mainFollowBtn.querySelector('i');
                    const text = mainFollowBtn.querySelector('span');
                    
                    icon.className = 'bi bi-bell-fill me-2';
                    text.textContent = 'Following';
                    mainFollowBtn.classList.add('btn-primary');
                    mainFollowBtn.classList.remove('btn-outline-primary');
                }
                
                // Reset modal button
                followBtn.innerHTML = originalText;
                followBtn.disabled = false;
            }, 1500);
        };
        
        // Print author details
        window.printAuthorDetails = function() {
            window.print();
        };
        
        // Share author profile
        window.shareAuthor = function() {
            if (navigator.share) {
                navigator.share({
                    title: `${author.name} - Library Author`,
                    text: `Check out ${author.name}'s profile and ${author.books.count} books at Ramat Library`,
                    url: window.location.href,
                })
                .then(() => showToast('Author profile shared successfully!', 'success'))
                .catch(error => {
                    console.log('Error sharing:', error);
                    copyToClipboard(window.location.href);
                    showToast('Profile link copied to clipboard', 'info');
                });
            } else {
                copyToClipboard(window.location.href);
                showToast('Profile link copied to clipboard', 'info');
            }
        };
        
        // Helper function to copy to clipboard
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }
        
        // Toast notification function
        function showToast(message, type = 'info') {
            const toastId = 'toast-' + Date.now();
            const toast = document.createElement('div');
            toast.id = toastId;
            toast.className = `toast align-items-center text-white bg-${type} border-0 position-fixed`;
            toast.style.bottom = '20px';
            toast.style.right = '20px';
            toast.style.zIndex = '1060';
            
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        <i class="bi bi-${type === 'success' ? 'check-circle' : 'info-circle'} me-2"></i>
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            const bsToast = new bootstrap.Toast(toast, {
                autohide: true,
                delay: 3000
            });
            
            bsToast.show();
            
            toast.addEventListener('hidden.bs.toast', function() {
                toast.remove();
            });
        }
        
        // Book card hover effects
        const bookCards = document.querySelectorAll('.book-card');
        bookCards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                const image = this.querySelector('.card-img-top');
                const badges = this.querySelectorAll('.badge');
                
                if (image) {
                    image.style.transform = 'scale(1.05)';
                }
                
                badges.forEach(badge => {
                    badge.style.transform = 'scale(1.1)';
                });
            });
            
            card.addEventListener('mouseleave', function() {
                const image = this.querySelector('.card-img-top');
                const badges = this.querySelectorAll('.badge');
                
                if (image) {
                    image.style.transform = 'scale(1)';
                }
                
                badges.forEach(badge => {
                    badge.style.transform = 'scale(1)';
                });
            });
        });
        
        // Similar author card effects
        const similarAuthorCards = document.querySelectorAll('.similar-author-card');
        similarAuthorCards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                const avatar = this.querySelector('.similar-author-avatar');
                const button = this.querySelector('.btn');
                
                if (avatar) {
                    avatar.style.transform = 'scale(1.1)';
                }
                if (button) {
                    button.classList.add('btn-primary');
                    button.classList.remove('btn-outline-primary');
                }
            });
            
            card.addEventListener('mouseleave', function() {
                const avatar = this.querySelector('.similar-author-avatar');
                const button = this.querySelector('.btn');
                
                if (avatar) {
                    avatar.style.transform = 'scale(1)';
                }
                if (button) {
                    button.classList.remove('btn-primary');
                    button.classList.add('btn-outline-primary');
                }
            });
        });
        
        // Author avatar hover effect
        const authorAvatar = document.querySelector('.author-header-avatar .avatar-container');
        if (authorAvatar) {
            authorAvatar.addEventListener('mouseenter', function() {
                this.style.transform = 'scale(1.05) rotate(5deg)';
            });
            
            authorAvatar.addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1) rotate(0)';
            });
        }
        
        // Portrait container hover effect
        const portraitContainer = document.querySelector('.portrait-container');
        if (portraitContainer) {
            portraitContainer.addEventListener('mouseenter', function() {
                this.style.transform = 'scale(1.02)';
            });
            
            portraitContainer.addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1)';
            });
            
            // Click to view larger
            portraitContainer.addEventListener('click', function() {
                const modal = new bootstrap.Modal(document.createElement('div'));
                const modalElement = document.createElement('div');
                modalElement.className = 'modal fade';
                modalElement.innerHTML = `
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content border-0">
                            <div class="modal-header border-0">
                                <h5 class="modal-title">${author.name}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body p-0">
                                <div class="portrait-placeholder d-flex align-items-center justify-content-center"
                                     style="height: 400px; background: linear-gradient(135deg, #0a2472, #3a86ff);">
                                    <div class="text-center text-white">
                                        <span class="display-1 fw-bold d-block">${author.name[0].toUpperCase()}</span>
                                        <span class="fs-4">${author.name}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modalElement);
                const bsModal = new bootstrap.Modal(modalElement);
                bsModal.show();
                
                // Remove from DOM after hiding
                modalElement.addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modalElement);
                });
            });
        }
        
        // Stats item hover effects
        const statItems = document.querySelectorAll('.stat-item');
        statItems.forEach(item => {
            item.addEventListener('mouseenter', function() {
                const number = this.querySelector('.stat-number');
                if (number) {
                    number.style.transform = 'scale(1.1)';
                }
            });
            
            item.addEventListener('mouseleave', function() {
                const number = this.querySelector('.stat-number');
                if (number) {
                    number.style.transform = 'scale(1)';
                }
            });
        });
        
        // Table row hover effects
        const tableRows = document.querySelectorAll('.table tbody tr');
        tableRows.forEach(row => {
            row.addEventListener('mouseenter', function() {
                const buttons = this.querySelectorAll('.btn');
                buttons.forEach(btn => {
                    btn.style.transform = 'scale(1.05)';
                });
            });
            
            row.addEventListener('mouseleave', function() {
                const buttons = this.querySelectorAll('.btn');
                buttons.forEach(btn => {
                    btn.style.transform = 'scale(1)';
                });
            });
        });
        
        // View books by year button
        const viewByYearBtn = document.createElement('button');
        viewByYearBtn.className = 'btn btn-sm btn-outline-primary ms-2';
        viewByYearBtn.innerHTML = '<i class="bi bi-calendar-week me-1"></i>View by Year';
        viewByYearBtn.setAttribute('data-bs-toggle', 'modal');
        viewByYearBtn.setAttribute('data-bs-target', '#booksByYearModal');
        
        const booksHeader = document.querySelector('.card-header .badge');
        if (booksHeader) {
            booksHeader.parentElement.appendChild(viewByYearBtn);
        }
        
        // Initialize tooltips
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // 'f' to follow author
            if (e.key === 'f' && !e.ctrlKey && !e.metaKey && followBtn) {
                e.preventDefault();
                followBtn.click();
            }
            
            // 'b' to view all books
            if (e.key === 'b' && !e.ctrlKey && !e.metaKey) {
                e.preventDefault();
                document.querySelector('a[href*="/catalog/books/?author="]').click();
            }
            
            // 'p' to print
            if (e.key === 'p' && (e.ctrlKey || e.metaKey)) {
                e.preventDefault();
                window.printAuthorDetails();
            }
        });
        
        // Animate stats on scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const statNumbers = entry.target.querySelectorAll('.stat-number');
                    statNumbers.forEach((stat, index) => {
                        setTimeout(() => {
                            stat.classList.add('animate__animated', 'animate__pulse');
                        }, index * 200);
                    });
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.5 });
        
        const statsCard = document.querySelector('.author-stats-card');
        if (statsCard) {
            observer.observe(statsCard);
        }
    });
</script>
{% endblock %}