{% extends 'base.html' %}

{% block title %}{{ faculty.name }} - Library Faculty{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="/catalog/">Catalog</a></li>
<li class="breadcrumb-item"><a href="/catalog/faculties/">Faculties</a></li>
<li class="breadcrumb-item active" aria-current="page">{{ faculty.name|truncatechars:30 }}</li>
{% endblock %}

{% block page_header %}
<div class="row mb-5 animate__animated animate__fadeIn">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-start flex-wrap">
            <div class="d-flex align-items-start">
                <!-- Faculty Avatar -->
                <div class="faculty-header-avatar me-4 d-none d-md-block">
                    <div class="avatar-container rounded-circle d-flex align-items-center justify-content-center"
                         style="width: 120px; height: 120px; background: linear-gradient(135deg, #0a2472, #3a86ff);">
                        <span class="text-white fs-1 fw-bold">{{ faculty.name|first|upper }}</span>
                    </div>
                </div>

                <!-- Faculty Info -->
                <div>
                    <h1 class="display-4 fw-bold mb-2">{{ faculty.name }}</h1>
                    <div class="d-flex flex-wrap align-items-center gap-2 mb-3">
                        <span class="badge bg-primary">
                            <i class="bi bi-building me-1"></i>{{ faculty.departments.count }} departments
                        </span>
                        <span class="badge bg-success">
                            <i class="bi bi-book me-1"></i>{{ faculty.books.count }} books
                        </span>
                        {% if faculty.description %}
                        <span class="badge bg-info">
                            <i class="bi bi-info-circle me-1"></i>Description Available
                        </span>
                        {% endif %}
                    </div>
                    <p class="lead text-muted mb-0">
                        {% if faculty.description %}
                        {{ faculty.description|truncatechars:150 }}
                        {% else %}
                        Academic faculty offering specialized programs across {{ faculty.departments.count }} departments.
                        {% endif %}
                    </p>
                </div>
            </div>
            <div class="mt-3 mt-md-0">
                {% if user.is_staff %}
                <div class="dropdown">
                    <button class="btn btn-outline-primary dropdown-toggle" type="button"
                            data-bs-toggle="dropdown">
                        <i class="bi bi-gear me-1"></i>Manage
                    </button>
                    <ul class="dropdown-menu">
                        <li>
                            <a class="dropdown-item" href="/admin/catalog/faculty/{{ faculty.id }}/change/">
                                <i class="bi bi-pencil me-2"></i>Edit Faculty
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="/admin/catalog/department/add/?faculty={{ faculty.id }}">
                                <i class="bi bi-plus-circle me-2"></i>Add Department
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="/admin/catalog/book/add/?faculty={{ faculty.id }}">
                                <i class="bi bi-plus-circle me-2"></i>Add Book
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item text-danger" href="/admin/catalog/faculty/{{ faculty.id }}/delete/">
                                <i class="bi bi-trash me-2"></i>Delete Faculty
                            </a>
                        </li>
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block content %}
<!-- Faculty Details Section -->
<div class="row mb-5">
    <!-- Faculty Sidebar -->
    <div class="col-lg-4 mb-5 mb-lg-0">
        <div class="card border-0 shadow-lg sticky-top" style="top: 100px;">
            <div class="card-body p-4">
                <!-- Faculty Portrait -->
                <div class="faculty-portrait mb-4">
                    <div class="portrait-container rounded-4 overflow-hidden position-relative">
                        <div class="portrait-placeholder d-flex align-items-center justify-content-center"
                             style="height: 300px; background: linear-gradient(135deg, #0a2472, #3a86ff);">
                            <div class="text-center text-white">
                                <span class="display-1 fw-bold d-block">{{ faculty.name|first|upper }}</span>
                                <span class="fs-5">{{ faculty.name }}</span>
                            </div>
                        </div>
                        <div class="position-absolute top-0 start-0 m-3">
                            <span class="badge bg-primary px-3 py-2 fs-6">
                                <i class="bi bi-building me-1"></i>Faculty
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Faculty Stats -->
                <div class="faculty-stats-card mb-4">
                    <div class="card border-0 bg-light">
                        <div class="card-body p-4">
                            <h5 class="fw-bold mb-4">Faculty Statistics</h5>
                            <div class="stats-grid">
                                <div class="stat-item text-center mb-4">
                                    <div class="stat-number fw-bold text-primary fs-3 mb-2">
                                        {{ faculty.departments.count }}
                                    </div>
                                    <div class="stat-label text-muted">Departments</div>
                                </div>
                                <div class="stat-item text-center mb-4">
                                    <div class="stat-number fw-bold text-success fs-3 mb-2">
                                        {{ faculty.books.count }}
                                    </div>
                                    <div class="stat-label text-muted">Total Books</div>
                                </div>
                                <div class="stat-item text-center mb-4">
                                    <div class="stat-number fw-bold text-warning fs-3 mb-2">
                                        {{ available_books|default:faculty.books.count }}
                                    </div>
                                    <div class="stat-label text-muted">Available Now</div>
                                </div>
                                <div class="stat-item text-center mb-4">
                                    <div class="stat-number fw-bold text-info fs-3 mb-2">
                                        {{ faculty.code|default:"N/A" }}
                                    </div>
                                    <div class="stat-label text-muted">Faculty Code</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions mb-4">
                    <div class="d-grid gap-2">
                        {% if user.is_authenticated %}
                        <button class="btn btn-outline-primary" id="followFaculty">
                            <i class="bi bi-bell me-2"></i>
                            <span>Follow Faculty</span>
                        </button>
                        {% endif %}
                        <button class="btn btn-outline-primary" onclick="printFacultyDetails()">
                            <i class="bi bi-printer me-2"></i>
                            <span>Print Profile</span>
                        </button>
                        <button class="btn btn-outline-primary" onclick="shareFaculty()">
                            <i class="bi bi-share me-2"></i>
                            <span>Share Profile</span>
                        </button>
                        <a href="/catalog/books/?faculty={{ faculty.id }}" class="btn btn-primary">
                            <i class="bi bi-book me-2"></i>
                            <span>View All Books</span>
                        </a>
                    </div>
                </div>

                <!-- Faculty Information -->
                <div class="faculty-info-card">
                    <div class="card border-0 bg-light">
                        <div class="card-body p-4">
                            <h6 class="fw-bold mb-3">Additional Information</h6>
                            <div class="info-list">
                                <div class="info-item mb-3">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-hash text-primary me-3"></i>
                                        <div>
                                            <small class="text-muted d-block">Faculty Code</small>
                                            <span class="fw-bold">{{ faculty.code|default:"Not specified" }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="info-item mb-3">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-diagram-3 text-primary me-3"></i>
                                        <div>
                                            <small class="text-muted d-block">Departments</small>
                                            <span class="fw-bold">{{ faculty.departments.count }} active departments</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="info-item mb-3">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-calendar text-primary me-3"></i>
                                        <div>
                                            <small class="text-muted d-block">Established</small>
                                            <span class="fw-bold">{{ established_year|default:"Information not available" }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-person-badge text-primary me-3"></i>
                                        <div>
                                            <small class="text-muted d-block">Programs</small>
                                            <span class="fw-bold">{{ programs_count|default:"Multiple programs available" }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Faculty Content -->
    <div class="col-lg-8">
        <!-- Description Section -->
        <div class="card border-0 shadow-lg mb-4">
            <div class="card-header bg-transparent border-0 py-3">
                <h3 class="fw-bold mb-0">About {{ faculty.name }}</h3>
            </div>
            <div class="card-body p-4">
                <div class="faculty-description">
                    {% if faculty.description %}
                    <div class="description-content">
                        {{ faculty.description|linebreaks }}
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-building text-muted fs-1 mb-3"></i>
                        <h5 class="text-muted mb-3">Description Not Available</h5>
                        <p class="text-muted">
                            Detailed information about this faculty is currently being updated.
                            Check back soon for more information.
                        </p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Departments in This Faculty -->
        <div class="card border-0 shadow-lg mb-4">
            <div class="card-header bg-transparent border-0 py-3 d-flex justify-content-between align-items-center">
                <div>
                    <h3 class="fw-bold mb-0">Departments in {{ faculty.name }}</h3>
                    <p class="text-muted mb-0 small">{{ faculty.departments.count }} departments in this faculty</p>
                </div>
                <span class="badge bg-primary">{{ faculty.departments.count }} Departments</span>
            </div>
            <div class="card-body p-4">
                {% if departments %}
                <div class="row g-4">
                    {% for department in departments %}
                    <div class="col-lg-6">
                        <div class="department-card card border-0 shadow-sm h-100">
                            <div class="card-body p-4">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <div class="flex-grow-1">
                                        <h5 class="fw-bold mb-2">{{ department.name }}</h5>
                                        <p class="text-muted small mb-3">
                                            {{ department.description|truncatechars:80|default:"Academic department offering specialized courses" }}
                                        </p>
                                        <div class="department-stats d-flex gap-3">
                                            <span class="badge bg-light text-dark">
                                                <i class="bi bi-hash me-1"></i>{{ department.code }}
                                            </span>
                                            <span class="badge bg-info">
                                                <i class="bi bi-book me-1"></i>{{ department.books.count }} books
                                            </span>
                                            <span class="badge bg-success">
                                                <i class="bi bi-diagram-3 me-1"></i>{{ department.topics.count }} topics
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mt-3">
                                    <small class="text-muted">
                                        {{ department.books.count }} books available
                                    </small>
                                    <div class="btn-group">
                                        <a href="/catalog/departments/{{ department.id }}/" class="btn btn-sm btn-outline-primary">
                                            View Details
                                        </a>
                                        <a href="/catalog/books/?department={{ department.id }}" class="btn btn-sm btn-primary">
                                            Browse Books
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                {% else %}
                <div class="text-center py-5">
                    <i class="bi bi-diagram-3 text-muted fs-1 mb-3"></i>
                    <h5 class="text-muted mb-3">No Departments Found</h5>
                    <p class="text-muted mb-4">
                        This faculty currently has no departments listed.
                    </p>
                    {% if user.is_staff %}
                    <a href="/admin/catalog/department/add/?faculty={{ faculty.id }}"
                       class="btn btn-primary">
                        <i class="bi bi-plus-circle me-2"></i>Add First Department
                    </a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Books in This Faculty -->
        <div class="card border-0 shadow-lg mb-4">
            <div class="card-header bg-transparent border-0 py-3 d-flex justify-content-between align-items-center">
                <div>
                    <h3 class="fw-bold mb-0">Books in {{ faculty.name }}</h3>
                    <p class="text-muted mb-0 small">{{ faculty.books.count }} books across all departments</p>
                </div>
                <span class="badge bg-success">{{ available_books|default:faculty.books.count }} Available</span>
            </div>
            <div class="card-body p-4">
                {% if faculty.books.exists %}
                <div class="row g-4">
                    {% for book in faculty.books.all|slice:":8" %}
                    <div class="col-lg-6">
                        <div class="card book-card h-100 border-0 shadow-hover">
                            <div class="row g-0 h-100">
                                <div class="col-md-4">
                                    <div class="position-relative h-100">
                                        <img src="{% static 'images/librarybooks.jfif' %}" class="img-fluid rounded-start h-100"
                                             alt="{{ book.title }}" style="object-fit: cover;">
                                        {% if book.is_available %}
                                        <span class="position-absolute top-0 start-0 m-2 badge bg-success">
                                            Available
                                        </span>
                                        {% else %}
                                        <span class="position-absolute top-0 start-0 m-2 badge bg-warning">
                                            Checked Out
                                        </span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="card-body d-flex flex-column h-100">
                                        <div class="flex-grow-1">
                                            <h6 class="card-title fw-bold mb-2">{{ book.title|truncatechars:50 }}</h6>
                                            <p class="card-text text-muted small mb-2">
                                                <i class="bi bi-person me-1"></i>
                                                {% for author in book.authors.all|slice:":1" %}
                                                {{ author.name }}
                                                {% endfor %}
                                            </p>
                                            <p class="card-text text-muted small mb-3">
                                                <i class="bi bi-building me-1"></i>{{ book.publisher.name|truncatechars:25 }}
                                            </p>
                                            <div class="mb-3">
                                                {% if book.department %}
                                                <span class="badge bg-info">{{ book.department.name|truncatechars:20 }}</span>
                                                {% endif %}
                                                {% if book.topic %}
                                                <span class="badge bg-success">{{ book.topic.name|truncatechars:20 }}</span>
                                                {% endif %}
                                                {% if book.genre %}
                                                <span class="badge bg-light text-dark">{{ book.genre.name }}</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="d-flex justify-content-between align-items-center mt-auto">
                                            <small class="text-muted">
                                                <i class="bi bi-calendar me-1"></i>{{ book.publication_date.year }}
                                            </small>
                                            <div>
                                                <a href="/catalog/books/{{ book.id }}/" class="btn btn-sm btn-primary">
                                                    <i class="bi bi-eye me-1"></i>View
                                                </a>
                                                {% if user.is_authenticated and book.is_available %}
                                                <a href="/circulation/reserve/{{ book.id }}/"
                                                   class="btn btn-sm btn-outline-primary ms-1">
                                                    Reserve
                                                </a>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                {% if faculty.books.count > 8 %}
                <div class="text-center mt-4">
                    <a href="/catalog/books/?faculty={{ faculty.id }}" class="btn btn-primary btn-lg">
                        <i class="bi bi-arrow-right-circle me-2"></i>
                        View All {{ faculty.books.count }} Books
                    </a>
                </div>
                {% endif %}

                {% else %}
                <div class="text-center py-5">
                    <i class="bi bi-book text-muted fs-1 mb-3"></i>
                    <h5 class="text-muted mb-3">No Books Found</h5>
                    <p class="text-muted mb-4">
                        This faculty currently has no books in our collection.
                    </p>
                    {% if user.is_staff %}
                    <a href="/admin/catalog/book/add/?faculty={{ faculty.id }}"
                       class="btn btn-primary">
                        <i class="bi bi-plus-circle me-2"></i>Add First Book
                    </a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Faculty Statistics Chart -->
        <div class="row g-4 mb-4">
            <div class="col-md-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body p-4">
                        <h5 class="fw-bold mb-4">Books by Department</h5>
                        <div class="departments-chart">
                            {% for department in departments|slice:":5" %}
                            <div class="department-item mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span class="fw-bold">{{ department.name|truncatechars:20 }}</span>
                                    <span class="text-muted">{{ department.books.count }} books</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar bg-primary"
                                         style="width: {% widthratio department.books.count faculty.books.count 100 %}%;">
                                    </div>
                                </div>
                            </div>
                            {% empty %}
                            <div class="text-center py-4">
                                <i class="bi bi-bar-chart text-muted fs-1 mb-3"></i>
                                <p class="text-muted">No department data available</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card border-0 shadow-sm h-100">
                    <div class="card-body p-4">
                        <h5 class="fw-bold mb-4">Top Genres in {{ faculty.name }}</h5>
                        <div class="genres-chart">
                            {% for genre_data in top_genres|slice:":5" %}
                            <div class="genre-item mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span class="fw-bold">{{ genre_data.name }}</span>
                                    <span class="text-muted">{{ genre_data.count }} books</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar bg-success"
                                         style="width: {% widthratio genre_data.count faculty.books.count 100 %}%;">
                                    </div>
                                </div>
                            </div>
                            {% empty %}
                            <div class="text-center py-4">
                                <i class="bi bi-tags text-muted fs-1 mb-3"></i>
                                <p class="text-muted">No genre data available</p>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Related Faculties -->
        <div class="card border-0 shadow-lg">
            <div class="card-header bg-transparent border-0 py-3">
                <h3 class="fw-bold mb-0">Other Faculties</h3>
                <p class="text-muted mb-0 small">Explore other academic faculties in our collection</p>
            </div>
            <div class="card-body p-4">
                <div class="row g-4">
                    {% for other_faculty in related_faculties|slice:":4" %}
                    <div class="col-lg-3 col-md-6">
                        <div class="related-faculty-card">
                            <div class="card border-0 shadow-sm h-100">
                                <div class="card-body p-3 text-center">
                                    <div class="related-faculty-avatar mb-3 mx-auto">
                                        <div class="rounded-circle d-flex align-items-center justify-content-center"
                                             style="width: 80px; height: 80px; background: linear-gradient(135deg,
                                                    {% cycle '#0a2472' '#001f3f' '#3a86ff' '#4361ee' as bgcolor %},
                                                    {% cycle '#3a86ff' '#4361ee' '#0a2472' '#001f3f' as bgcolor2 %});">
                                            <span class="text-white fw-bold">{{ other_faculty.name|first|upper }}</span>
                                        </div>
                                    </div>
                                    <h6 class="fw-bold mb-2">{{ other_faculty.name|truncatechars:20 }}</h6>
                                    <p class="text-muted small mb-3">
                                        {{ other_faculty.books.count }} books
                                    </p>
                                    <a href="/catalog/faculties/{{ other_faculty.id }}/"
                                       class="btn btn-sm btn-outline-primary">
                                        View Faculty
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="col-12">
                        <div class="text-center py-4">
                            <i class="bi bi-building text-muted fs-1 mb-3"></i>
                            <p class="text-muted">No other faculties available</p>
                            <a href="/catalog/faculties/" class="btn btn-outline-primary">
                                <i class="bi bi-arrow-right me-2"></i>Browse All Faculties
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ block.super }}
<style>
    /* Faculty Detail Specific Styles */
    .faculty-header-avatar .avatar-container {
        box-shadow: 0 10px 30px rgba(0, 31, 63, 0.2);
        transition: transform 0.3s ease;
    }

    .faculty-header-avatar:hover .avatar-container {
        transform: scale(1.05);
    }

    .portrait-container {
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        transition: transform 0.3s ease;
    }

    .portrait-container:hover {
        transform: scale(1.02);
    }

    .portrait-placeholder {
        background-size: cover;
        background-position: center;
    }

    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    .stat-item {
        padding: 1rem;
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        transition: all 0.2s ease;
    }

    .stat-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
    }

    /* Quick Actions */
    .quick-actions .btn {
        transition: all 0.2s ease;
    }

    .quick-actions .btn:hover {
        transform: translateY(-2px);
    }

    /* Info List */
    .info-item {
        padding: 0.5rem 0;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .info-item:last-child {
        border-bottom: none;
    }

    /* Description */
    .description-content {
        line-height: 1.8;
        color: var(--dark-text);
    }

    /* Department Cards */
    .department-card {
        transition: all 0.3s ease;
        border-left: 4px solid var(--primary-blue);
    }

    .department-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1) !important;
        border-left-color: var(--accent-blue);
    }

    .department-stats .badge {
        font-size: 0.75rem;
    }

    /* Book Cards */
    .book-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .book-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15) !important;
    }

    .book-card .card-img-top {
        transition: transform 0.5s ease;
    }

    .book-card:hover .card-img-top {
        transform: scale(1.05);
    }

    /* Charts */
    .departments-chart .progress-bar,
    .genres-chart .progress-bar {
        border-radius: 4px;
        transition: width 0.5s ease;
    }

    .department-item:hover .progress-bar,
    .genre-item:hover .progress-bar {
        opacity: 0.9;
    }

    /* Related Faculties */
    .related-faculty-card .card {
        transition: all 0.3s ease;
    }

    .related-faculty-card .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1) !important;
    }

    .related-faculty-avatar {
        transition: all 0.3s ease;
    }

    .related-faculty-card:hover .related-faculty-avatar {
        transform: scale(1.1);
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
        .faculty-header-avatar {
            margin-right: 1rem;
            margin-bottom: 1rem;
        }

        .faculty-header-avatar .avatar-container {
            width: 80px;
            height: 80px;
        }

        .faculty-header-avatar .avatar-container span {
            font-size: 1.5rem;
        }

        .portrait-container {
            height: 200px;
        }

        .stats-grid {
            grid-template-columns: 1fr;
        }

        .department-card {
            margin-bottom: 1rem;
        }

        .book-card {
            margin-bottom: 1rem;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Follow Faculty functionality
        const followBtn = document.getElementById('followFaculty');
        if (followBtn) {
            followBtn.addEventListener('click', function() {
                const modal = new bootstrap.Modal(document.createElement('div'));
                const modalElement = document.createElement('div');
                modalElement.className = 'modal fade';
                modalElement.innerHTML = `
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title fw-bold">Follow {{ faculty.name }}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <p>Get notifications when new books and departments are added to <strong>{{ faculty.name }}</strong>.</p>
                                <div class="mb-3">
                                    <label class="form-label">Notification Preferences</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="newBooksNotify" checked>
                                        <label class="form-check-label" for="newBooksNotify">
                                            New book additions
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="newDepartmentsNotify">
                                        <label class="form-check-label" for="newDepartmentsNotify">
                                            New departments
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="updatesNotify" checked>
                                        <label class="form-check-label" for="updatesNotify">
                                            Faculty updates
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary" onclick="followFaculty()">
                                    Start Following
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(modalElement);
                const bsModal = new bootstrap.Modal(modalElement);
                bsModal.show();

                // Remove from DOM after hiding
                modalElement.addEventListener('hidden.bs.modal', function() {
                    document.body.removeChild(modalElement);
                });
            });
        }

        // Follow faculty function
        window.followFaculty = function() {
            const newBooksNotify = document.getElementById('newBooksNotify').checked;
            const newDepartmentsNotify = document.getElementById('newDepartmentsNotify').checked;
            const updatesNotify = document.getElementById('updatesNotify').checked;

            // Show loading state
            const modal = bootstrap.Modal.getInstance(document.querySelector('.modal'));
            const followBtn = modal._element.querySelector('.btn-primary');
            const originalText = followBtn.innerHTML;

            followBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Following...';
            followBtn.disabled = true;

            // Simulate API call
            setTimeout(() => {
                // Success
                showToast(`Now following ${faculty.name}!`, 'success');

                // Update modal
                modal.hide();

                // Update follow button
                const mainFollowBtn = document.getElementById('followFaculty');
                if (mainFollowBtn) {
                    const icon = mainFollowBtn.querySelector('i');
                    const text = mainFollowBtn.querySelector('span');

                    icon.className = 'bi bi-bell-fill me-2';
                    text.textContent = 'Following';
                    mainFollowBtn.classList.add('btn-primary');
                    mainFollowBtn.classList.remove('btn-outline-primary');
                }

                // Reset modal button
                followBtn.innerHTML = originalText;
                followBtn.disabled = false;
            }, 1500);
        };

        // Print faculty details
        window.printFacultyDetails = function() {
            window.print();
        };

        // Share faculty profile
        window.shareFaculty = function() {
            if (navigator.share) {
                navigator.share({
                    title: `${faculty.name} - Library Faculty`,
                    text: `Explore books and departments in ${faculty.name} at Ramat Library`,
                    url: window.location.href,
                })
                .then(() => showToast('Faculty profile shared successfully!', 'success'))
                .catch(error => {
                    console.log('Error sharing:', error);
                    copyToClipboard(window.location.href);
                    showToast('Profile link copied to clipboard', 'info');
                });
            } else {
                copyToClipboard(window.location.href);
                showToast('Profile link copied to clipboard', 'info');
            }
        };

        // Helper function to copy to clipboard
        function copyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }

        // Toast notification function
        function showToast(message, type = 'info') {
            const toastId = 'toast-' + Date.now();
            const toast = document.createElement('div');
            toast.id = toastId;
            toast.className = `toast align-items-center text-white bg-${type} border-0 position-fixed`;
            toast.style.bottom = '20px';
            toast.style.right = '20px';
            toast.style.zIndex = '1060';

            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        <i class="bi bi-${type === 'success' ? 'check-circle' : 'info-circle'} me-2"></i>
                    ${message}
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
            `;

            document.body.appendChild(toast);

            const bsToast = new bootstrap.Toast(toast, {
                autohide: true,
                delay: 3000
            });

            bsToast.show();

            toast.addEventListener('hidden.bs.toast', function() {
                toast.remove();
            });
        }

        // Department card hover effects
        const departmentCards = document.querySelectorAll('.department-card');
        departmentCards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-5px)';
                this.style.boxShadow = '0 15px 30px rgba(0, 0, 0, 0.15)';
            });

            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
                this.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.05)';
            });
        });

        // Book card hover effects
        const bookCards = document.querySelectorAll('.book-card');
        bookCards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                const image = this.querySelector('img');
                const badges = this.querySelectorAll('.badge');

                if (image) {
                    image.style.transform = 'scale(1.05)';
                }

                badges.forEach(badge => {
                    badge.style.transform = 'scale(1.1)';
                });
            });

            card.addEventListener('mouseleave', function() {
                const image = this.querySelector('img');
                const badges = this.querySelectorAll('.badge');

                if (image) {
                    image.style.transform = 'scale(1)';
                }

                badges.forEach(badge => {
                    badge.style.transform = 'scale(1)';
                });
            });
        });

        // Related faculty card effects
        const relatedFacultyCards = document.querySelectorAll('.related-faculty-card');
        relatedFacultyCards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                const avatar = this.querySelector('.related-faculty-avatar');
                const button = this.querySelector('.btn');

                if (avatar) {
                    avatar.style.transform = 'scale(1.1)';
                }
                if (button) {
                    button.classList.add('btn-primary');
                    button.classList.remove('btn-outline-primary');
                }
            });

            card.addEventListener('mouseleave', function() {
                const avatar = this.querySelector('.related-faculty-avatar');
                const button = this.querySelector('.btn');

                if (avatar) {
                    avatar.style.transform = 'scale(1)';
                }
                if (button) {
                    button.classList.remove('btn-primary');
                    button.classList.add('btn-outline-primary');
                }
            });
        });

        // Faculty avatar hover effect
        const facultyAvatar = document.querySelector('.faculty-header-avatar .avatar-container');
        if (facultyAvatar) {
            facultyAvatar.addEventListener('mouseenter', function() {
                this.style.transform = 'scale(1.05) rotate(5deg)';
            });

            facultyAvatar.addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1) rotate(0)';
            });
        }

        // Portrait container hover effect
        const portraitContainer = document.querySelector('.portrait-container');
        if (portraitContainer) {
            portraitContainer.addEventListener('mouseenter', function() {
                this.style.transform = 'scale(1.02)';
            });

            portraitContainer.addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1)';
            });
        }

        // Stats item hover effects
        const statItems = document.querySelectorAll('.stat-item');
        statItems.forEach(item => {
            item.addEventListener('mouseenter', function() {
                const number = this.querySelector('.stat-number');
                if (number) {
                    number.style.transform = 'scale(1.1)';
                }
            });

            item.addEventListener('mouseleave', function() {
                const number = this.querySelector('.stat-number');
                if (number) {
                    number.style.transform = 'scale(1)';
                }
            });
        });

        // Animate stats on scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const statNumbers = entry.target.querySelectorAll('.stat-number');
                    statNumbers.forEach((stat, index) => {
                        setTimeout(() => {
                            stat.classList.add('animate__animated', 'animate__pulse');
                        }, index * 200);
                    });
                    observer.unobserve(entry.target);
                }
            });
        }, { threshold: 0.5 });

        const statsCard = document.querySelector('.faculty-stats-card');
        if (statsCard) {
            observer.observe(statsCard);
        }
    });
</script>
{% endblock %}
